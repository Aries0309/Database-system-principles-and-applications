实验 5 数据操纵

# 一、实验目的

- 了解多表连接的过程
- 掌握连接查询的方法
- 掌握嵌套查询的方法

# 二、实验环境

- PC 机（CPU 主频 2.0GHz 以上，4G 以上内存，80GB 以上硬盘空间）
- Win 7 或 Win 10 操作系统
- SQL Server 2008（或以上版本）

# 三、实验内容

数据库 LoanDB 中包含三张关系表，数据模式如下：

| **BankT**  |                                   |                |
| ---------- | --------------------------------- | -------------- |
| **属性名** | **数据类型**                      | **说明**       |
| Bno        | 定长字符串，长度 5                | 银行编号，主键 |
| Bname      | 变长字符串，Unicode 编码，长度 10 | 银行名称       |
| Btel       | 定长字符串，长度 8                | 联系电话       |

| **LegalEntityT** |                                   |                |
| ---------------- | --------------------------------- | -------------- |
| **属性名**       | **数据类型**                      | **说明**       |
| Eno              | 定长字符串，长度 3                | 法人编号，主键 |
| Ename            | 变长字符串，Unicode 编码，长度 15 | 法人名称       |
| Enature          | 定长字符串，Unicode 编码，长度 2  | 经济性质       |
| Ecapital         | 整型                              | 注册资金       |
| Erep             | 变长字符串，Unicode 编码，长度 4  | 法人代表       |

| **LoanT**  |                    |                                         |
| ---------- | ------------------ | --------------------------------------- |
| **属性名** | **数据类型**       | **说明**                                |
| Eno        | 定长字符串，长度 3 | 银行编号，主键，参照关系表 LegalEntityT |
| Bno        | 定长字符串，长度 5 | 银行编号，主键，参照关系关系表 BankT    |
| Ldate      | 时间日期           | 放贷日期，主键                          |
| Lamount    | 整型               | 贷款金额（万元）                        |
| Lterm      | 整型               | 贷款年限                                |

请编写 T-SQL 语句实现以下操作，在 SSMS 中执行，并将执行结果截图：

- 将“建设银行上海 B 支行”的记录插入到银行表中（代码： B321B， 电话： 021-7845）
- 在贷款表中插入一条记录（法人代码：E10，银行代码：B111C，贷款日期：默认值，贷款金额：100 万元）
- 查询除工商银行以外各家银行的总贷款金额，将查询结果保存到表“LoanAmount”中，该表包括银行名称和总贷款金额等 2 列
- 查询工商银行各分行、支行的总贷款金额，查询结果仍然保存在表“LoanAmount”中
- 在表“LoanAmount”中所有银行名称后面加上“汇总”两字
- 将贷款表中法人代码“E10”在银行“B111C”贷款的贷款金额增加 100 万

- 将表“LoanAmount”中各支行、分行在 2005 年放过贷的银行名称前加“\*”号标注
- 删除银行表中银行代码“ B321B”的记录，和贷款表中“法人代码： E10，银行编号：B111C”的记录
- 删除表“LoanAmount”中与“建设银行”相关的所有记录
- 删除表“LoanAmount”中银行电话为“010-3489”的记录
- 删除表“LoanAmount” 中全部记录
- 删除表“LoanAmount”
- 创建经济性质为“国营”的法人视图 L1
- 在 L1 视图中插入两条经济性质分别为“国营”和“私营”的法人信息， 然后查看法人表和视图 L1
- 修改 L1 中一条记录的法人代表，然后查看法人表和视图 L1
- 基于 L1 查询经济性质为“国营”，且注册资金在 1000 万元以上（含 1000 万元）的法人
- 创建建设银行的视图 L2，并要求进行修改和插入操作时仍需保证该视图只有建设银行的信息
- 在 L2 视图中插入两条记录，一条是某建设银行的信息，另一条为某工商银行的信息，并查看银行表
- 查询与“浦庆石化有限公司”经济性质相同的法人
- 查询每家银行“私营”法人贷款的总金额占本银行贷款总金额的比例要求保留到小数点后 3 位
