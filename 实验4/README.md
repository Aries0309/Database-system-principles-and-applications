# 实验 4 复杂查询

**一、实验目的**

- 了解多表连接的过程
- 掌握连接查询的方法
- 掌握嵌套查询的方法

**二、实验环境**

- PC 机（CPU 主频 2.0GHz 以上，4G 以上内存，80GB 以上硬盘空间）
- Win 7 或 Win 10 操作系统
- SQL Server 2008（或以上版本）

**三、实验内容**

数据库 LoanDB 中包含三张关系表，数据模式如下：

| **BankT**  |                                   |                |
| ---------- | --------------------------------- | -------------- |
| **属性名** | **数据类型**                      | **说明**       |
| Bno        | 定长字符串，长度 5                | 银行编号，主键 |
| Bname      | 变长字符串，Unicode 编码，长度 10 | 银行名称       |
| Btel       | 定长字符串，长度 8                | 联系电话       |

| **LegalEntityT** |                                   |                |
| ---------------- | --------------------------------- | -------------- |
| **属性名**       | **数据类型**                      | **说明**       |
| Eno              | 定长字符串，长度 3                | 法人编号，主键 |
| Ename            | 变长字符串，Unicode 编码，长度 15 | 法人名称       |
| Enature          | 定长字符串，Unicode 编码，长度 2  | 经济性质       |
| Ecapital         | 整型                              | 注册资金       |
| Erep             | 变长字符串，Unicode 编码，长度 4  | 法人代表       |

| **LoanT**  |                    |                                         |
| ---------- | ------------------ | --------------------------------------- |
| **属性名** | **数据类型**       | **说明**                                |
| Eno        | 定长字符串，长度 3 | 法人编号，主键，参照关系表 LegalEntityT |
| Bno        | 定长字符串，长度 5 | 银行编号，主键，参照关系关系表 BankT    |
| Ldate      | 时间日期           | 放贷日期，主键                          |
| Lamount    | 整型               | 贷款金额（万元）                        |
| Lterm      | 整型               | 贷款年限                                |

请编写 T-SQL 语句实现以下查询，在 SSMS 中执行，并将查询结果截图：

- 查询北京地区各家银行发放贷款的总金额。仅输出贷款总额在 3000 万元以上银行代码和贷款总额
- 查询“工商银行北京 A 支行”发放的贷款记录。要求输出：银行名称，法人代码，贷款金额，贷款日期
- 查询非国营法人的贷款信息。要求输出：法人代码，法人名称，经济性质，银行代码，贷款金额，贷款日期
- 查询已到期贷款的法人名称，贷款金额，贷款日期，贷款期限
- 查询每家法人的贷款总额。要求输出：法人代码，法人名称，贷款总额，并按贷款总额降序排列
- 查询私营企业的贷款信息。要求输出：法人名称、银行名称、贷款金额、贷款期限
- 查询“工商银行北京 A 支行”给哪些法人贷过款，输出：法人代码和法人名称
- 查询北京市每家银行为各种经济性质的法人提供贷款的次数和贷款总额，按银行名称排序
- 查询与“华顺达水泥股份有限公司”经济性质相同的法人的基本情况
- 查询哪些法人多次贷款，输出法人的基本信息
- 查询法人及其贷款情况，包括贷款的法人和没有贷款的法人，列出法人代码、法人名称、经济性质、银行代码、贷款日期和贷款金额
- 查询哪些银行没有放贷记录
- 查询与法人“华顺达水泥股份有限公司”经济性质相同的法人名称和经济性质
- 查询在“工商银行北京 A 支行”贷过款的法人名称
- 查询没有在“B111B”银行贷过款的法人代码、法人名称及其经济性质
- 查询在银行“B111B”贷款金额最高的法人名称、经济性质和注册资金
- 查询在银行“B111B”贷款且贷款金额高于此银行的平均贷款金额的法人代码、贷款日期和贷款金额
- 查询既在工商银行又在交通银行贷过款的法人名称
