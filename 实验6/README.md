实验 6 存储过程

# 一、实验目的

- 了解存储程的概念
- 掌握存储过程的创建方法
- 掌握存储过程的使用方法
- 掌握存储过程参数的使用方法

# 二、实验环境

- PC 机（CPU 主频 2.0GHz 以上，4G 以上内存，80GB 以上硬盘空间）
- Win 7 或 Win 10 操作系统
- SQL Server 2008（或以上版本）

# 三、实验内容

数据库 LoanDB 中包含三张关系表，数据模式如下：

| **Bank T** |                                   |                |
| ---------- | --------------------------------- | -------------- |
| **属性名** | **数据类型**                      | **说明**       |
| Bno        | 定长字符串，长度 5                | 银行编号，主键 |
| Bname      | 变长字符串，Unicode 编码，长度 10 | 银行名称       |
| Btel       | 定长字符串，长度 8                | 联系电话       |

| **LegalEntityT** |                                   |                |
| ---------------- | --------------------------------- | -------------- |
| **属性名**       | **数据类型**                      | **说明**       |
| Eno              | 定长字符串，长度 3                | 法人编号，主键 |
| Ename            | 变长字符串，Unicode 编码，长度 15 | 法人名称       |
| Enature          | 定长字符串，Unicode 编码，长度 2  | 经济性质       |
| Ecapital         | 整型                              | 注册资金       |
| Erep             | 变长字符串，Unicode 编码，长度 4  | 法人代表       |

| **LoanT**         |                    |                        |
| ----------------- | ------------------ | ---------------------- |
| **属性名**        | **数据类型**       | **说明**               |
| Eno               | 定长字符串，长度 3 | 银行编号，主键，参照关 |
| 系表 LegalEntityT |

| Bno     | 定长字符串，长度 5 | 银行编号，主键，参照关系关系表 BankT |
| ------- | ------------------ | ------------------------------------ |
| Ldate   | 时间日期           | 放贷日期，主键                       |
| Lamount | 整型               | 贷款金额（万元）                     |
| Lterm   | 整型               | 贷款年限                             |

请编写以下存储过程，在 SSMS 中执行，并将执行结果截图：

- 创建并执行存储过程 p_1,查询“工商银行北京 A 支行”的贷款情况，要求列出法人名称、贷款日期和贷款金额。
- 创建带输入参数的存储过程 p_2，查询某家指定银行的贷款情况，要求列出法人名称、贷款日期和贷款金额。执行该存储过程查询“工商银行北京 B 支行”的贷款情况。
- 创建带输入参数和默认值的存储过程 p_3，查询某家指定银行（银行名称的默认值为“工商银行北京分行”）的贷款情况，要求列出法人名称、贷款日期和贷款金额。执行该存储过程分别查询“工商银行北京分行” 和“工商银行北京 A 支行” 的贷款情况。
- 创建带多个输入参数的存储过程 p_4，查询某个指定法人在某家指定银行的贷款情况，要求列出法人名称、银行名称、贷款日期和贷款金额。执行该存储过程查询“浦庆石化有限公司 ”在“建设银行上海 A 分行” 的贷款情况。
- 创建带输入参数和输出参数的存储过程 p_5，统计指定城市的银行在指定日期以后的贷款总金额和平均贷款金额，将统计结果作为输出参数。执行该存储过程查询“北京”市的所有银行在‘2008-1-1’以后的贷款总金额和平均贷款金额。
- 创建存储过程 p_7，统计：在指定银行贷款且贷款金额高于此银行平均贷款金额的法人名称、贷款日期和贷款金额。如果指定银行为 “工商银行北京 B 支行”，执行此存储过程，查询符合条件的贷款人。
- 创建带输入参数、输出参数和默认值的存储过程 p_6 ， 统计： m+(m+1)+(m+2)+„+n 的和，其中 m 和 n 都为整数，且 m<n，m、n 的默认值分别为 1 和 100。执行该存储过程，计算 1~20 以内整数的和。
